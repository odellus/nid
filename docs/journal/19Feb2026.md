---
title: Thoughts on crow architecture
date: "2026-02-19"
---

```python
from crow_acp import AcpAgent, MultiAgent
from crow_skills import default_skills
from crow_compact import default_compact

def get_base_callbacks():
    return CrowCallbacks(
        begin_session=[],
        pre_request=[default_skills()],
        post_response=[default_compact()],
        end_turn=[],
    )

def add_agent_callback(callbacks: CrowCallbacks, next_agent: AcpAgent) -> CrowCallbacks:
    """Add a bridge to next_agent in the end_turn hooks."""
    new_callbacks = callbacks.model_copy()
    new_callbacks.end_turn.append(agent_bridge(next_agent))
    return new_callbacks

def build_chain():
    """Build a → b → c chain."""
    agent_a = AcpAgent()
    agent_b = AcpAgent()
    agent_c = AcpAgent()
    
    # Base callbacks (no bridges)
    base = get_base_callbacks()
    
    # Build chain backwards: c gets no bridge, b → c, a → b
    callbacks_c = base  # c is terminal, no bridge
    callbacks_b = add_agent_callback(callbacks_c, agent_c)  # b → c
    callbacks_a = add_agent_callback(callbacks_b, agent_b)  # a → b
    
    # Apply callbacks
    agent_a.set_callbacks(callbacks_a)
    agent_b.set_callbacks(callbacks_b)
    agent_c.set_callbacks(callbacks_c)
    
    # Entry point
    return MultiAgent(entry_agent=agent_a)
```
